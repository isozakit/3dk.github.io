<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GLB Viewer — Collection 切替スイッチ</title>
  <style>
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP';}
    #app{display:grid;grid-template-columns:300px 1fr;height:100vh}
    #sidebar{padding:12px;border-right:1px solid #ddd;overflow:auto}
    #viewer{background:#111}
    .collection-item{display:flex;align-items:center;margin:6px 0}
    label{margin-left:8px}
    header{font-weight:700;margin-bottom:8px}
    .hint{font-size:13px;color:#666;margin-top:10px}
    button{margin-top:8px;padding:6px 10px;border-radius:6px;border:1px solid #ccc;background:#fff}
  </style>
</head>
<body>
  <div id="app">
    <aside id="sidebar">
      <header>コレクション表示切替</header>
      <div id="controls">読み込み中…</div>
      <div class="hint">※GLB 内のノード名（Collection等）を元に自動で一覧化します。ノード名は Blender 等で設定してください。</div>
      <button id="resetBtn">全て表示</button>
    </aside>
    <main id="viewer"></main>
  </div>

  <!-- three.js と例・ローダーを CDN から読み込み -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>

 <!-- 置き換え前の <script src="...three.min.js"> ... </script> を削除して以下を追加 -->
<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.152.2/build/three.module.js';
  import { OrbitControls } from 'https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js';
  import { GLTFLoader } from 'https://unpkg.com/three@0.152.2/examples/jsm/loaders/GLTFLoader.js';

  // ここから既存コード（ほぼそのまま）を入れてOK。ただし OrbitControls の生成が変わります:
  const container = document.getElementById('viewer');
  const controlsPane = document.getElementById('controls');
  const resetBtn = document.getElementById('resetBtn');

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 300) / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 3);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth - 300, window.innerHeight);
  container.appendChild(renderer.domElement);

  // ← ここが重要：new THREE.OrbitControls ではなく、モジュールから直接使う
  const orbit = new OrbitControls(camera, renderer.domElement);
  orbit.target.set(0, 1, 0);
  orbit.update();

  // GLTFLoader の使い方はほぼ同じ
  const loader = new GLTFLoader();
  const GLB_PATH = 'mouthmove-demo2-18.glb';

  // （以降はあなたの既存スクリプトをそのまま流用できます）
  // 例: loader.load(GLB_PATH, (gltf) => { ... }, (xhr)=>{...}, (err)=>{...});
  // 注意: 既存コード内で THREE.OrbitControls を参照している箇所があれば
  //    OrbitControls に置換してください（上の new OrbitControls(...) のように）。
</script>

</body>
</html>


<!-- README（短い手順） -->

<!--
使い方:
1) リポジトリ構成例:
   /index.html  <- このファイル
   /models/mouthmove-demo2-18.glb  <- アップロードした GLB

2) GitHub に push する
   - リポジトリを作成してファイルを追加して push してください。
   - GitHub Pages で公開する方法: Settings -> Pages から "branch: main" と "/ (root)" を選ぶか、/docs フォルダに入れて "branch: main /docs" を選択してください。
   - もしくは gh-pages ブランチを作って公開しても OK。

3) パスの確認
   - GLB のパスが変わる場合は、index.html 内の GLB_PATH を編集してください。

4) Blender での準備
   - コレクション名（Collection）をノード名（Object 名）としてエクスポートすると、このビューワで見やすくなります。
   - ノード名が空の場合は自動で Collection_0 などの名前が付けられます。

補足:
- より細かく "メッシュごと" や "子ノードまで展開してトグル" したい場合は、findCollections 関数をカスタマイズしてください。
- セキュリティ: GitHub Pages では raw.githubusercontent.com から直接モデルを読み込むのも可能ですが、同じリポジトリに置くのが簡単です。
-->

